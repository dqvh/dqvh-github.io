<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juego del Impostor - Versi√≥n Mejorada</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            text-align: center;
            max-width: 600px;
            width: 100%;
            min-height: 500px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            transition: all 0.5s ease;
        }

        h1, h2 {
            color: #333;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .setup-screen, .player-setup-screen, .transfer-screen, .game-screen, .discussion-screen, .voting-transfer-screen, .voting-turn-screen, .results-screen {
            display: none;
        }

        .setup-screen {
            display: block;
        }

        input, select {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.3);
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin: 10px 0;
            width: 100%;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        button:active {
            transform: translateY(0);
        }

        .role-card {
            background: #f8f9fa;
            border: 3px solid #ddd;
            border-radius: 15px;
            padding: 40px;
            margin: 20px 0;
            font-size: 24px;
            font-weight: bold;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: transform 0.5s ease;
        }

        .role-card.reveal {
            transform: scale(1.05);
        }

        .impostor-card {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            color: white;
            border-color: #ff4757;
            animation: pulse 2s infinite;
        }

        .innocent-card {
            background: linear-gradient(135deg, #51cf66, #40c057);
            color: white;
            border-color: #37b24d;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 107, 107, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 107, 107, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 107, 107, 0); }
        }

        .timer {
            font-size: 48px;
            font-weight: bold;
            color: #ff4757;
            margin: 20px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .player-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }

        .player-vote {
            background: #f8f9fa;
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .player-vote:hover {
            background: #e9ecef;
            transform: scale(1.05);
        }

        .player-vote.selected {
            background: #667eea;
            color: white;
            border-color: #5a67d8;
        }

        .warning, .success, .danger {
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-weight: bold;
        }

        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }

        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .danger {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .player-names-container {
            max-height: 300px;
            overflow-y: auto;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Pantalla de configuraci√≥n -->
        <div class="setup-screen" id="setupScreen">
            <h1>üïµÔ∏è Juego del Impostor - Mejorado</h1>
            <p>Mejoras: Nombres personalizados, votaci√≥n secreta por turnos, din√°mica separada de discusi√≥n y votaci√≥n, animaciones suaves, UI m√°s responsiva.</p>
            
            <input type="text" id="themeInput" placeholder="¬øQu√© tienen que adivinar? (ej: Animales, Comidas, Pel√≠culas)">
            
            <select id="playerCount">
                <option value="3">3 Jugadores</option>
                <option value="4">4 Jugadores</option>
                <option value="5" selected>5 Jugadores</option>
                <option value="6">6 Jugadores</option>
                <option value="7">7 Jugadores</option>
                <option value="8">8 Jugadores</option>
                <option value="9">9 Jugadores</option>
                <option value="10">10 Jugadores</option>
            </select>
            
            <button onclick="setupPlayers()">üöÄ Configurar Jugadores</button>
        </div>

        <!-- Pantalla de configuraci√≥n de jugadores -->
        <div class="player-setup-screen" id="playerSetupScreen">
            <h2>üìù Ingresa Nombres de Jugadores</h2>
            <p>Deja en blanco para usar "Jugador X" por defecto.</p>
            <div class="player-names-container" id="playerNamesContainer"></div>
            <button onclick="startGame()">‚úÖ Continuar al Juego</button>
        </div>

        <!-- Pantalla de transferencia para roles -->
        <div class="transfer-screen" id="transferScreen">
            <h2>üì± Pasar el Tel√©fono</h2>
            
            <div style="font-size: 100px; margin: 40px 0;">ü§ê</div>
            
            <div class="warning">
                <strong>¬°ATENCI√ìN!</strong><br>
                Pasa el tel√©fono al <span id="nextPlayerName">Jugador X</span><br>
                SIN que vea la pantalla
            </div>
            
            <p style="font-size: 18px; margin: 20px 0;">
                <strong id="receivingPlayer">Jugador X</strong>: Cuando tengas el tel√©fono, presiona para descubrir tu rol.
            </p>
            
            <button onclick="showPlayerRole()" style="background: #28a745;">üîç Descubrir Mi Rol</button>
        </div>

        <!-- Pantalla del juego (roles) -->
        <div class="game-screen" id="gameScreen">
            <h2 id="playerTitle">Jugador 1</h2>
            
            <div class="role-card" id="roleCard">
                <div id="roleText"></div>
                <div id="themeText"></div>
            </div>
            
            <div class="warning">
                <strong>¬°Memoriza tu rol!</strong><br>
                Cuando termines, presiona "Listo" para borrar y continuar.
            </div>
            
            <button onclick="finishPlayerTurn()" id="finishButton" style="background: #dc3545;">‚úÖ Listo - Borrar y Continuar</button>
        </div>

        <!-- Pantalla de discusi√≥n -->
        <div class="discussion-screen" id="discussionScreen">
            <h2>üí¨ Tiempo de Discusi√≥n</h2>
            
            <div class="timer" id="discussionTimer">3:00</div>
            
            <div class="warning">
                Discutan palabras relacionadas con el tema secreto. ¬°El impostor intentar√° mezclarse!
            </div>
            
            <button onclick="startVotingPhase()" style="background: #ffc107;">üó≥Ô∏è Iniciar Votaci√≥n Secreta</button>
        </div>

        <!-- Pantalla de transferencia para votos -->
        <div class="voting-transfer-screen" id="votingTransferScreen">
            <h2>üì± Pasar el Tel√©fono para Votar</h2>
            
            <div style="font-size: 100px; margin: 40px 0;">ü§´</div>
            
            <div class="warning">
                <strong>¬°ATENCI√ìN!</strong><br>
                Pasa el tel√©fono al <span id="nextVoterName">Jugador X</span><br>
                SIN que vea la pantalla
            </div>
            
            <p style="font-size: 18px; margin: 20px 0;">
                <strong id="receivingVoter">Jugador X</strong>: Cuando tengas el tel√©fono, presiona para votar en secreto.
            </p>
            
            <button onclick="showVotingTurn()" style="background: #28a745;">üó≥Ô∏è Votar en Secreto</button>
        </div>

        <!-- Pantalla de turno de votaci√≥n -->
        <div class="voting-turn-screen" id="votingTurnScreen">
            <h2 id="voterTitle">Voto de Jugador 1</h2>
            
            <div class="warning">
                Elige qui√©n crees que es el impostor. ¬°Tu voto es secreto!
            </div>
            
            <div class="player-list" id="votingPlayerList"></div>
            
            <button onclick="confirmVote()" id="confirmVoteButton" style="background: #28a745;" disabled>‚úÖ Confirmar Voto</button>
        </div>

        <!-- Pantalla de resultados -->
        <div class="results-screen" id="resultsScreen">
            <h2>üé≠ Resultados</h2>
            
            <div id="resultsContent"></div>
            
            <button onclick="resetGame()">üîÑ Jugar de Nuevo</button>
        </div>
    </div>

    <script>
        let gameData = {
            theme: '',
            playerCount: 5,
            currentPlayer: 0, // Comienza en 0 para primer transfer
            impostorIndex: -1,
            playerNames: [],
            votes: [],
            discussionTimer: null,
            timeLeft: 180, // 3 minutos
            selectedVote: -1,
            currentVoter: 0 // Para votaci√≥n
        };

        function setupPlayers() {
            const theme = document.getElementById('themeInput').value.trim();
            if (!theme) {
                alert('¬°Por favor ingresa un tema!');
                return;
            }
            
            gameData.theme = theme;
            gameData.playerCount = parseInt(document.getElementById('playerCount').value);
            
            // Mostrar pantalla de nombres
            document.getElementById('setupScreen').style.display = 'none';
            document.getElementById('playerSetupScreen').style.display = 'block';
            
            const container = document.getElementById('playerNamesContainer');
            container.innerHTML = '';
            gameData.playerNames = new Array(gameData.playerCount + 1);
            
            for (let i = 1; i <= gameData.playerCount; i++) {
                const input = document.createElement('input');
                input.type = 'text';
                input.id = `playerName${i}`;
                input.placeholder = `Nombre del Jugador ${i} (opcional)`;
                container.appendChild(input);
            }
        }

        function startGame() {
            // Guardar nombres
            for (let i = 1; i <= gameData.playerCount; i++) {
                const name = document.getElementById(`playerName${i}`).value.trim();
                gameData.playerNames[i] = name || `Jugador ${i}`;
            }
            
            // Elegir impostor
            gameData.impostorIndex = Math.floor(Math.random() * gameData.playerCount) + 1;
            gameData.votes = new Array(gameData.playerCount + 1).fill(0);
            
            // Iniciar con transferencia al primer jugador
            document.getElementById('playerSetupScreen').style.display = 'none';
            showTransferScreenForRole();
        }

        function showTransferScreenForRole() {
            if (gameData.currentPlayer < gameData.playerCount) {
                const next = gameData.currentPlayer + 1;
                document.getElementById('nextPlayerName').textContent = gameData.playerNames[next];
                document.getElementById('receivingPlayer').textContent = gameData.playerNames[next];
                document.getElementById('transferScreen').style.display = 'block';
            } else {
                startDiscussion();
            }
        }

        function showPlayerRole() {
            gameData.currentPlayer++;
            document.getElementById('transferScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'block';
            updatePlayerScreen();
        }

        function updatePlayerScreen() {
            const playerTitle = document.getElementById('playerTitle');
            const roleCard = document.getElementById('roleCard');
            const roleText = document.getElementById('roleText');
            const themeText = document.getElementById('themeText');
            const finishButton = document.getElementById('finishButton');
            
            playerTitle.textContent = gameData.playerNames[gameData.currentPlayer];
            
            if (gameData.currentPlayer === gameData.impostorIndex) {
                roleCard.className = 'role-card impostor-card reveal';
                roleText.textContent = 'üé≠ ERES EL IMPOSTOR';
                themeText.textContent = '¬°No sabes el tema! Desc√∫brelo sin que te noten.';
            } else {
                roleCard.className = 'role-card innocent-card reveal';
                roleText.textContent = 'üë• ERES INOCENTE';
                themeText.textContent = `Tema: ${gameData.theme.toUpperCase()}`;
            }
            
            finishButton.textContent = gameData.currentPlayer === gameData.playerCount ? '‚úÖ Listo - Iniciar Discusi√≥n' : '‚úÖ Listo - Borrar y Continuar';
        }

        function finishPlayerTurn() {
            // Reset animaci√≥n
            document.getElementById('roleCard').classList.remove('reveal');
            document.getElementById('gameScreen').style.display = 'none';
            showTransferScreenForRole();
        }

        function startDiscussion() {
            document.getElementById('discussionScreen').style.display = 'block';
            startTimer();
        }

        function startTimer() {
            gameData.timeLeft = 180;
            const timerElement = document.getElementById('discussionTimer');
            
            gameData.discussionTimer = setInterval(() => {
                const minutes = Math.floor(gameData.timeLeft / 60);
                const seconds = gameData.timeLeft % 60;
                timerElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                if (gameData.timeLeft <= 0) {
                    clearInterval(gameData.discussionTimer);
                    timerElement.textContent = '¬°TIEMPO!';
                    startVotingPhase();
                }
                
                gameData.timeLeft--;
            }, 1000);
        }

        function startVotingPhase() {
            clearInterval(gameData.discussionTimer);
            document.getElementById('discussionScreen').style.display = 'none';
            gameData.currentVoter = 0;
            showTransferScreenForVote();
        }

        function showTransferScreenForVote() {
            if (gameData.currentVoter < gameData.playerCount) {
                const next = gameData.currentVoter + 1;
                document.getElementById('nextVoterName').textContent = gameData.playerNames[next];
                document.getElementById('receivingVoter').textContent = gameData.playerNames[next];
                document.getElementById('votingTransferScreen').style.display = 'block';
            } else {
                showResults();
            }
        }

        function showVotingTurn() {
            gameData.currentVoter++;
            document.getElementById('votingTransferScreen').style.display = 'none';
            document.getElementById('votingTurnScreen').style.display = 'block';
            updateVotingTurnScreen();
        }

        function updateVotingTurnScreen() {
            const voterTitle = document.getElementById('voterTitle');
            voterTitle.textContent = `Voto de ${gameData.playerNames[gameData.currentVoter]}`;
            
            const playerList = document.getElementById('votingPlayerList');
            playerList.innerHTML = '';
            gameData.selectedVote = -1;
            document.getElementById('confirmVoteButton').disabled = true;
            
            // Opci√≥n de saltar
            const skipDiv = document.createElement('div');
            skipDiv.className = 'player-vote';
            skipDiv.textContent = 'Saltar (no votar)';
            skipDiv.onclick = () => selectVote(0, skipDiv);
            playerList.appendChild(skipDiv);
            
            for (let i = 1; i <= gameData.playerCount; i++) {
                if (i === gameData.currentVoter) continue; // No votar por uno mismo
                const playerDiv = document.createElement('div');
                playerDiv.className = 'player-vote';
                playerDiv.textContent = gameData.playerNames[i];
                playerDiv.onclick = () => selectVote(i, playerDiv);
                playerList.appendChild(playerDiv);
            }
        }

        function selectVote(playerNum, element) {
            document.querySelectorAll('.player-vote').forEach(div => div.classList.remove('selected'));
            element.classList.add('selected');
            gameData.selectedVote = playerNum;
            document.getElementById('confirmVoteButton').disabled = false;
        }

        function confirmVote() {
            if (gameData.selectedVote > 0) {
                gameData.votes[gameData.selectedVote]++;
            }
            document.getElementById('votingTurnScreen').style.display = 'none';
            showTransferScreenForVote();
        }

        function showResults() {
            document.getElementById('resultsScreen').style.display = 'block';
            
            const resultsContent = document.getElementById('resultsContent');
            let html = `<h3>üé≠ El impostor era: <span style="color: #ff4757;">${gameData.playerNames[gameData.impostorIndex]}</span></h3>`;
            
            // Encontrar el m√°s votado
            let maxVotes = 0;
            let mostVoted = [];
            for (let i = 1; i <= gameData.playerCount; i++) {
                if (gameData.votes[i] > maxVotes) {
                    maxVotes = gameData.votes[i];
                    mostVoted = [i];
                } else if (gameData.votes[i] === maxVotes) {
                    mostVoted.push(i);
                }
            }
            
            if (mostVoted.length === 1 && mostVoted[0] === gameData.impostorIndex) {
                html += '<div class="success">üéâ ¬°Los inocentes ganaron! Encontraron al impostor.</div>';
            } else {
                html += '<div class="danger">üòà ¬°El impostor gan√≥! No lo descubrieron.</div>';
                if (mostVoted.length > 0) {
                    html += `<p>M√°s votados: ${mostVoted.map(i => gameData.playerNames[i]).join(', ')} (${maxVotes} votos)</p>`;
                } else {
                    html += '<p>No hubo votos suficientes.</p>';
                }
            }
            
            html += `<p><strong>Tema:</strong> ${gameData.theme}</p>`;
            
            // Mostrar tally de votos
            html += '<h4>Votos recibidos:</h4><ul>';
            for (let i = 1; i <= gameData.playerCount; i++) {
                html += `<li>${gameData.playerNames[i]}: ${gameData.votes[i]} votos</li>`;
            }
            html += '</ul>';
            
            resultsContent.innerHTML = html;
        }

        function resetGame() {
            // Resetear datos
            gameData = {
                theme: '',
                playerCount: 5,
                currentPlayer: 0,
                impostorIndex: -1,
                playerNames: [],
                votes: [],
                discussionTimer: null,
                timeLeft: 180,
                selectedVote: -1,
                currentVoter: 0
            };
            
            // Mostrar pantalla inicial
            document.getElementById('resultsScreen').style.display = 'none';
            document.getElementById('setupScreen').style.display = 'block';
            
            // Limpiar campos
            document.getElementById('themeInput').value = '';
            document.getElementById('playerCount').value = '5';
        }
    </script>
</body>
</html>
